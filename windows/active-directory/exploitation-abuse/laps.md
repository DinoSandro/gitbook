# LAPS

## Theory

LPAS (Local Administrator Password Solution) provides centralized storage of local users in AD with periodic randomizing

Is stored in clear text but the transmission is encrypted (Kerberos).

## Abuse

### Enumeration

If LAPS is enabled a library AdmPwd.dll can be found in the C:\Program Files\LAPS\CSE\ directory. To find user who can read the passwords in clear text machines in OUs using powerview:

{% code overflow="wrap" %}
```powershell
Get-DomainOU | Get-DomainObjectAcl -ResolveGUIDs | where-Object {($_.ObjectAceType -like 'ms-Mcs-AdmPwn') -and ($_.ActiveDirectoryRights -match 'ReadProperty')} | ForEach-Object {$_ | Add-Member NoteProperty 'IdentityName' $(Convert-SidToName $_.SecurityIdentifier);$_}
```
{% endcode %}

To find OU where LAPS is in user import the LAPS module (can be copied across machines):

{% code overflow="wrap" %}
```powershell
Import-Module ./AdmPwd.PS.psd1
Find-AdmPwdExtendedRights -Identity OUDistinguishedName
```
{% endcode %}
