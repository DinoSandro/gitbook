# ADCS

## Theory

{% hint style="info" %}
When enumerate, certify "find" option will not flag vulnerable template if they don't have the enrollements right for low privilege user, even if you can exploit them!
{% endhint %}

Active Directory Certificates Services (AD CS) enables use of Public Key Infrastructure (PKI) in active directory forest.

It helps in authenticating users and machines, encrypting and signing documents, filesystem, emails and more

## Abuse

### Enumerate

[https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified\_Pre-Owned.pdf](https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified\_Pre-Owned.pdf)

<pre class="language-bash"><code class="lang-bash"><strong>certipy-ad find -u &#x3C;USER> -p &#x3C;PASS> -dc-ip &#x3C;IP> -vulnerable -stdout
</strong></code></pre>

```powershell
./Certify.exe find /vulnerable
```

<figure><img src="../../../../.gitbook/assets/Pasted image 20230719143059.png" alt=""><figcaption></figcaption></figure>

There are different type of abuse:

### Theft

//TODO

### Persistence

{% hint style="info" %}
Gain persistence throught certificates is preferred beacuse usually the password are changed in three or so months, while if you have a old certificate it should last at least one year
{% endhint %}

//TODO

### Escalation

* [esc1.md](esc1.md "mention")
* [esc3.md](esc3.md "mention")
* [esc4.md](esc4.md "mention")
* [esc6.md](esc6.md "mention")

//TODO

### Domain Persistence

//TODO

### Cross Domain Attacks

//TODO

## References

[https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified\_Pre-Owned.pdf](https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified\_Pre-Owned.pdf)

